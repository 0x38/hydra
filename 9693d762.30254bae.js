(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{166:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return u}));var r=n(1),a=n(9),o=(n(0),n(200)),i={id:"basic",title:"Introduction to Structured Configs",sidebar_label:"Introduction to Structured Configs"},c={id:"tutorials/structured_config/basic",title:"Introduction to Structured Configs",description:"This is an advanced tutorial that assumes that you are comfortable with the concepts introduced in the [Basic Tutorial](/tutorials/basic/1_simple_cli_app.md).",source:"@site/docs/tutorials/structured_config/1_basic.md",permalink:"/docs/next/tutorials/structured_config/basic",editUrl:"https://github.com/facebookresearch/hydra/edit/master/website/docs/tutorials/structured_config/1_basic.md",version:"next",lastUpdatedBy:"Omry Yadan",lastUpdatedAt:1582776942,sidebar_label:"Introduction to Structured Configs",sidebar:"Docs",previous:{title:"Debugging",permalink:"/docs/next/tutorials/basic/debugging"},next:{title:"Custom node path",permalink:"/docs/next/tutorials/structured_config/node_path"}},s=[{value:"Structured Configs major features",id:"structured-configs-major-features",children:[]},{value:"Overviw",id:"overviw",children:[]}],l={rightToc:s};function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"This is an advanced tutorial that assumes that you are comfortable with the concepts introduced in the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/next/tutorials/basic/simple_cli"}),"Basic Tutorial"),"."),Object(o.b)("p",null,"Structured configs are classes that are used to define your config, enabling two primary features:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"Static type checking"),": The config object looks much like an instance of the underlying type, you can annotate it as that type and use Mypy or other static\ntype checkers to perform static type analysis on your config objects."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"Runtime type checking"),": The type information in retained at runtime and is used to validate that changes to your object are conforming to underlying type specification.\nThis is especially useful for catching type errors during the composition of your configuration.")),Object(o.b)("p",null,"Structured Configs are new in ",Object(o.b)("strong",{parentName:"p"},"Hydra 1.0.0"),". The key idea is behind them is that can use regular Python dataclasses to describe your configuration structure and types.\nThe configuration objects created from Structured Configs uses the type information for validating the composition and other mutations of the config."),Object(o.b)("h3",{id:"structured-configs-major-features"},"Structured Configs major features"),Object(o.b)("p",null,"Some of the major features of Structured Configs:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Primitive types (int, bool, float, str, Enums) "),Object(o.b)("li",{parentName:"ul"},"Nesting of structured configs"),Object(o.b)("li",{parentName:"ul"},"Containers (List and Dict) containing primitives or Structured Configs."),Object(o.b)("li",{parentName:"ul"},"Optional fields")),Object(o.b)("h4",{id:"structured-configs-limitations"},"Structured Configs Limitations"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"Union")," types are not supported (except ",Object(o.b)("inlineCode",{parentName:"li"},"Optional"),")"),Object(o.b)("li",{parentName:"ul"},"User methods are not supported.")),Object(o.b)("h3",{id:"overviw"},"Overviw"),Object(o.b)("p",null,"There are two primary ways for using Structured configs."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"In place of configuration files"),Object(o.b)("li",{parentName:"ul"},"As a ",Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"/docs/next/tutorials/structured_config/schema"}),"schema")," validating configuration files")),Object(o.b)("p",null,"With both methods, you get everything else Hydra has to offer (Config composition, Command line overrides etc).\nThis tutorial covers both methods, read it in order."),Object(o.b)("p",null,"This tutorial does not assume complete knowledge of Structured Configs. Visit the ",Object(o.b)("a",{class:"external",href:"https://omegaconf.readthedocs.io/en/latest/structured_config.html",target:"_blank"},"OmegaConf Structured Configs page")," to learn more."),Object(o.b)("div",{class:"alert alert--info",role:"alert"},"1. The APIs and behaviors described in this tutorial are experimental and may change in a future version",Object(o.b)("br",null),"2. Structured configs are new, please report any issues",Object(o.b)("br",null)),Object(o.b)("br",null),Object(o.b)("h4",{id:"minimal-example"},"Minimal example"),Object(o.b)("p",null,"This tutorial uses the ",Object(o.b)("inlineCode",{parentName:"p"},"ConfigStore"),", a Singleton that stores configs in memory, in a structured similar to the file system."),Object(o.b)("p",null,"Below is a minimal example that stores a structured config into the ",Object(o.b)("inlineCode",{parentName:"p"},"ConfigStore")," and then uses that config as the primary config of the application.\nPay special attention to the fact that the type of the ",Object(o.b)("inlineCode",{parentName:"p"},"cfg")," object is declared as ",Object(o.b)("inlineCode",{parentName:"p"},"MySQLConfig"),".\nThis enables static type checking of the config object (Which is actually an instance of DictConfig)."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-python"}),'from dataclasses import dataclass\n\nimport hydra\nfrom hydra.core.config_store import ConfigStore\n\n@dataclass\nclass MySQLConfig:\n    driver: str = "mysql"\n    host: str = "localhost"\n    port: int = 3306\n    user: str = "omry"\n    password: str = "secret"\n\n\ncfg_store = ConfigStore.instance()\n# Registering the Config class with the name \'config\'\ncfg_store.store(node=MySQLConfig, name="config")\n\n@hydra.main(config_name="config")\ndef my_app(cfg: MySQLConfig) -> None:\n    # The real type of cfg is DictConfig, but we lie a little to get static type checking.\n    # If it swims like a duck and quacks like a duck, it\'s a "duck".\n    print(\n        f"Connecting to {cfg.driver} at {cfg.host}:{cfg.port}, user={cfg.user}, password={cfg.password}"\n    )\n\n\nif __name__ == "__main__":\n    my_app()\n')),Object(o.b)("h4",{id:"expected-output"},"Expected output"),Object(o.b)("p",null,"The resulting application will offer the same features as any other Hydra application."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-text"}),"$ python my_app.py user=bond\nConnecting to mysql at localhost:3306, user=bond, password=1234\n")),Object(o.b)("p",null,"In addition to the static type checking, You also get runtime type checking.\nFor example, overriding the port to something that cannot be converted to an integer will result in a ValidationError."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-python"}),"$ python my_app.py port=fail\nTraceback (most recent call last):\n...\nomegaconf.errors.ValidationError: Error setting 'port = fail' : Value 'fail' could not be converted to Integer\n")),Object(o.b)("h4",{id:"using-objects-in-place-of-classes"},"Using objects in place of classes"),Object(o.b)("p",null,"You can use instances of the dataclasses when storing the configs. Allowing easy overriding of default values.\nIf you are registering 'config' more than once the last one will replace the previous ones."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-python"}),'cfg_store.store(node=MySQLConfig(user="root", password="1234"), name="config")\n')))}u.isMDXComponent=!0},200:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),u=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},p=function(e){var t=u(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=u(n),d=r,f=p["".concat(i,".").concat(d)]||p[d]||b[d]||o;return n?a.a.createElement(f,c({ref:t},l,{components:n})):a.a.createElement(f,c({ref:t},l))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);