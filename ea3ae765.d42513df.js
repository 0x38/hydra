(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{233:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return p})),n.d(t,"default",(function(){return s}));var a=n(2),r=n(7),i=(n(0),n(251)),l={id:"configuring_experiments",title:"Configuring Experiments"},c={unversionedId:"patterns/configuring_experiments",id:"patterns/configuring_experiments",isDocsHomePage:!1,title:"Configuring Experiments",description:"Example application",source:"@site/docs/patterns/configuring_experiments.md",slug:"/patterns/configuring_experiments",permalink:"/docs/next/patterns/configuring_experiments",editUrl:"https://github.com/facebookresearch/hydra/edit/master/website/docs/patterns/configuring_experiments.md",version:"current",lastUpdatedBy:"Omry Yadan",lastUpdatedAt:1610077556,sidebar:"docs",previous:{title:"Extending Configs",permalink:"/docs/next/patterns/extending_configs"},next:{title:"Specializing configuration",permalink:"/docs/next/patterns/specializing_config"}},p=[{value:"Problem",id:"problem",children:[]},{value:"Solution",id:"solution",children:[]},{value:"Example",id:"example",children:[]},{value:"Sweeping over experiments",id:"sweeping-over-experiments",children:[]}],o={rightToc:p};function s(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},o,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebookresearch/hydra/tree/master/examples/patterns/configuring_experiments"}),Object(i.b)("img",Object(a.a)({parentName:"a"},{src:"https://img.shields.io/badge/-Example%20application-informational",alt:"Example application"})))),Object(i.b)("h3",{id:"problem"},"Problem"),Object(i.b)("p",null,"A common problem is maintaining multiple configurations of an application.  This can get especially\ntedious when the configuration differences span multiple dimensions.\nThis pattern shows how to cleanly support multiple configurations, with each configuration file only specifying\nthe changes to the master (default) configuration."),Object(i.b)("h3",{id:"solution"},"Solution"),Object(i.b)("p",null,"Create a config file specifying the overrides to the default configuration, and then call it via the command line.\ne.g. ",Object(i.b)("inlineCode",{parentName:"p"},"$ python my_app.py +experiment=fast_mode"),"."),Object(i.b)("p",null,"To avoid clutter, we place the experiment config files in dedicated config group called ",Object(i.b)("em",{parentName:"p"},"experiment"),"."),Object(i.b)("h3",{id:"example"},"Example"),Object(i.b)("p",null,"In this example, we will create configurations for each of the server and database pairings that we want to benchmark."),Object(i.b)("p",null,"The default configuration is:"),Object(i.b)("div",{className:"row"},Object(i.b)("div",{className:"col col--4"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="config.yaml"',title:'"config.yaml"'}),"defaults:\n  - db: mysql\n  - server: apache\n\n\n\n\n\n"))),Object(i.b)("div",{className:"col col--4"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="db/mysql.yaml"',title:'"db/mysql.yaml"'}),"name: sqlite\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="server/apache.yaml"',title:'"server/apache.yaml"'}),"name: apache\nport: 80\n"))),Object(i.b)("div",{className:"col col--4"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="db/sqlite.yaml"',title:'"db/sqlite.yaml"'}),"name: sqlite\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="server/nginx.yaml"',title:'"server/nginx.yaml"'}),"name: nginx\nport: 80\n")))),Object(i.b)("div",{className:"row"},Object(i.b)("div",{className:"col col--6"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text",metastring:'title="Directory structure"',title:'"Directory','structure"':!0}),"\u251c\u2500\u2500 config.yaml\n\u251c\u2500\u2500 db\n\u2502   \u251c\u2500\u2500 mysql.yaml\n\u2502   \u2514\u2500\u2500 sqlite.yaml\n\u2514\u2500\u2500 server\n    \u251c\u2500\u2500 apache.yaml\n    \u2514\u2500\u2500 nginx.yaml\n"))),Object(i.b)("div",{className:"col col--6"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="$ python my_app.py"',title:'"$',python:!0,'my_app.py"':!0}),"db:\n  name: mysql\nserver:\n  name: apache\n  port: 80\n\n\n")))),Object(i.b)("p",null,"The benchmark config files specify the deltas from the default configuration:"),Object(i.b)("div",{className:"row"},Object(i.b)("div",{className:"col col--6"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="experiment/aplite.yaml"',title:'"experiment/aplite.yaml"'}),"# @package _global_\ndefaults:\n  - override /db: sqlite\n  \n  \nserver:\n  port: 8080\n"))),Object(i.b)("div",{className:"col col--6"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="experiment/nglite.yaml"',title:'"experiment/nglite.yaml"'}),"# @package _global_\ndefaults:\n  - override /db: sqlite\n  - override /server: nginx\n  \nserver:\n  port: 8080\n")))),Object(i.b)("div",{className:"row"},Object(i.b)("div",{className:"col col--6"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="$ python my_app.py +experiment=aplite"',title:'"$',python:!0,"my_app.py":!0,"+experiment":'aplite"'}),"db:\n  name: sqlite\nserver:\n  name: apache\n  port: 8080\n"))),Object(i.b)("div",{className:"col col--6"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="$ python my_app.py +experiment=nglite"',title:'"$',python:!0,"my_app.py":!0,"+experiment":'nglite"'}),"db:\n  name: sqlite\nserver:\n  name: nginx\n  port: 8080\n")))),Object(i.b)("p",null,"Key concepts:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"#"," @package ","_","global","_"),Object(i.b)("br",{parentName:"li"}),"Changes specified in this config should be interpreted as relative to the ","_","global","_"," package.",Object(i.b)("br",{parentName:"li"}),"We could instead place ",Object(i.b)("em",{parentName:"li"},"nglite.yaml")," and ",Object(i.b)("em",{parentName:"li"},"aplite.yaml")," next to ",Object(i.b)("em",{parentName:"li"},"config.yaml")," and omit this line."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"The overrides of /db and /server are absolute paths."),Object(i.b)("br",{parentName:"li"}),"This is necessary because they are outside of the experiment directory. ")),Object(i.b)("p",null,"Running the experiments from the command line requires prefixing the experiment choice with a ",Object(i.b)("inlineCode",{parentName:"p"},"+"),".\nThe experiment config group is an addition, not an override."),Object(i.b)("h3",{id:"sweeping-over-experiments"},"Sweeping over experiments"),Object(i.b)("p",null,"This approach also enables sweeping over those experiments to easily compare their results:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text",metastring:'title="$ python my_app.py --multirun +experiment=aplite,nglite"',title:'"$',python:!0,"my_app.py":!0,"--multirun":!0,"+experiment":'aplite,nglite"'}),"[HYDRA] Launching 2 jobs locally\n[HYDRA]        #0 : +experiment=aplite\ndb:\n  name: sqlite\nserver:\n  name: apache\n  port: 8080\n\n[HYDRA]        #1 : +experiment=nglite\ndb:\n  name: sqlite\nserver:\n  name: nginx\n  port: 8080\n")),Object(i.b)("p",null,"To run all the experiment, use the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"../../advanced/override_grammar/extended#glob-choice-sweep"}),"glob")," syntax:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text",metastring:"title=\"$ python my_app.py --multirun '+experiment=glob(*)'\"",title:'"$',python:!0,"my_app.py":!0,"--multirun":!0,"'+experiment":"glob(*)'\""}),"[HYDRA]        #0 : +experiment=aplite\n...\n[HYDRA]        #1 : +experiment=nglite\n...\n")))}s.isMDXComponent=!0},251:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return g}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=r.a.createContext({}),s=function(e){var t=r.a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},m=function(e){var t=s(e.components);return r.a.createElement(o.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,o=p(e,["components","mdxType","originalType","parentName"]),m=s(n),u=a,g=m["".concat(l,".").concat(u)]||m[u]||b[u]||i;return n?r.a.createElement(g,c(c({ref:t},o),{},{components:n})):r.a.createElement(g,c({ref:t},o))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=u;var c={};for(var p in t)hasOwnProperty.call(t,p)&&(c[p]=t[p]);c.originalType=e,c.mdxType="string"==typeof e?e:a,l[1]=c;for(var o=2;o<i;o++)l[o]=n[o];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);